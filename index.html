<!DOCTYPE html>
<html>
<head>
  <title>Roblox UI Builder</title>
  <style>
    body { font-family: sans-serif; display: flex; gap: 20px; padding: 20px; }
    .preview { border:1px solid #aaa; width:500px; height:400px; position:relative; background:#f4f4f4; }
    .ui-element { position:absolute; border:1px solid #444; background:rgba(0,0,0,0.1); }
    .drag-handle, .resize-handle { width:16px; height:16px; position:absolute; font-size:10px; text-align:center; line-height:16px; }
    .drag-handle { top:0; left:0; background:#555; cursor:move; }
    .resize-handle { bottom:0; right:0; background:#888; cursor:nwse-resize; }
    #explorer { width:220px; border:1px solid #ccc; height:400px; overflow:auto; background:#fff; padding:5px;}
    .explorer-item { padding:2px 4px; cursor:pointer; display:flex; align-items:center; user-select:none; }
    .explorer-item.selected { background:#def; }
    .icon { width:16px; text-align:center; user-select:none; }
    .toggle { width:16px; cursor:pointer; }
    #panel { width:300px; display:flex; flex-direction:column; gap:8px; }
    textarea { width:100%; height:200px; }
  </style>
</head>
<body>

<div>
  <h2>UI Builder</h2>
  <label>Type:
    <select id="instanceType">
      <option>Frame</option><option>TextLabel</option><option>TextButton</option>
      <option>ImageLabel</option><option>Folder</option><option>Model</option>
    </select>
  </label>
  <button onclick="addElement()">Add Element</button>
  <div class="preview" id="preview"></div>
</div>

<div id="explorer">
  <b>Explorer</b><br>
  <div id="explorerList"></div>
</div>

<div id="panel">
  <h3>Properties</h3>
  <div id="propFields"></div>
  <button onclick="applyProperties()">Apply</button>
  <h3>Generated Lua</h3>
  <textarea id="output"></textarea>
</div>

<script>
let idCounter=0, selected=null, currentParent=null;
const typeProps = {
  Frame: ['Name','Left','Top','Width','Height','Color'],
  TextLabel: ['Name','Left','Top','Width','Height','Color','Text'],
  TextButton: ['Name','Left','Top','Width','Height','Color','Text'],
  ImageLabel: ['Name','Left','Top','Width','Height','Color','Image'],
  Folder: ['Name'],
  Model: ['Name']
};

function addElement(){
  const t=document.getElementById('instanceType').value; idCounter++;
  const e=document.createElement('div'); e.className='ui-element';
  Object.assign(e.dataset,{id:idCounter,type:t,name:`${t}${idCounter}`,parent:currentParent?.dataset.id||'ScreenGui'});
  e.style.left='50px'; e.style.top='50px'; e.style.width='100px'; e.style.height='50px';
  ['color','text','image'].forEach(p=>delete e.dataset[p]);
  const drag=document.createElement('div'), resize=document.createElement('div');
  drag.className='drag-handle'; drag.innerText='≡'; resize.className='resize-handle'; resize.innerText='↘';
  e.append(drag,resize);
  drag.onmousedown=e=>startDrag(e.target.parentElement);
  resize.onmousedown=e=>startResize(e.target.parentElement);
  e.onclick=ev=>{ ev.stopPropagation(); select(e,true); };
  (currentParent||document.getElementById('preview')).appendChild(e);
  refresh();
}

function select(e,focusExplorer){
  selected=e; currentParent=e; renderProps();
  highlight(); if(focusExplorer) renderExplorer();
  generateCode();
}

function startDrag(el){
  const pr=el.parentElement.getBoundingClientRect(), ox=parseInt(el.style.left), oy=parseInt(el.style.top);
  const move=ev=>{ el.style.left=(ev.clientX-pr.left-ox)+'px'; el.style.top=(ev.clientY-pr.top-oy)+'px'; renderProps(); generateCode();};
  document.addEventListener('mousemove',move);
  document.addEventListener('mouseup',()=>document.removeEventListener('mousemove',move),{once:true});
}

function startResize(el){
  const sx=event.clientX, sy=event.clientY, sw=parseInt(el.style.width), sh=parseInt(el.style.height);
  const move=ev=>{ el.style.width=(sw+ev.clientX-sx)+'px'; el.style.height=(sh+ev.clientY-sy)+'px'; renderProps(); generateCode();};
  document.addEventListener('mousemove',move);
  document.addEventListener('mouseup',()=>document.removeEventListener('mousemove',move),{once:true});
}

function renderProps(){
  const cont=document.getElementById('propFields'); cont.innerHTML='';
  if(!selected) return;
  const props=typeProps[selected.dataset.type];
  props.forEach(p=>{
    const fld=document.createElement('div');
    fld.innerHTML=`<label>${p}: <input id="prop${p}" /></label>`;
    cont.appendChild(fld);
    const val = ['Left','Top','Width','Height'].includes(p)
      ? selected.style[p.toLowerCase()].replace('px','')
      : selected.dataset[p.toLowerCase()] || '';
    document.getElementById('prop'+p).value = val;
  });
}

function applyProperties(){
  if(!selected) return;
  typeProps[selected.dataset.type].forEach(p=>{
    const val=document.getElementById('prop'+p).value;
    if(['Left','Top','Width','Height'].includes(p)) selected.style[p.toLowerCase()]=val+'px';
    else selected.dataset[p.toLowerCase()]=val;
  });
  refresh();
}

function highlight(){
  document.querySelectorAll('.ui-element').forEach(e=>e.classList.toggle('selected',e===selected));
}

function renderExplorer(){
  const root=document.getElementById('explorerList'); root.innerHTML='';
  function build(pid, lvl){
    document.querySelectorAll('.ui-element').forEach(e=>{
      if(e.dataset.parent===pid){
        const row=document.createElement('div'); row.className='explorer-item';
        row.style.paddingLeft=(lvl*12)+'px';
        if(['Folder','Model'].includes(e.dataset.type)){
          const tok=document.createElement('span');
          tok.className='toggle'; tok.innerText = e.dataset._expanded?'▼':'▶';
          tok.onclick = ev => { ev.stopPropagation(); e.dataset._expanded = !e.dataset._expanded; renderExplorer(); };
          row.appendChild(tok);
        } else row.appendChild(document.createElement('span')).className='toggle';
        const ico=document.createElement('span'); ico.className='icon';
        ico.innerText = {'Frame':'☐','TextLabel':'T','TextButton':'↿','ImageLabel':'🖼','Folder':'📁','Model':'📦'}[e.dataset.type];
        row.appendChild(ico);
        const name=document.createElement('span'); name.textContent=e.dataset.name;
        row.appendChild(name);
        row.onclick = () => select(e,false);
        if(e.dataset._expanded) build(e.dataset.id, lvl+1);
        root.appendChild(row);
      }
    });
  }
  build('ScreenGui',0);
}

function generateCode(){
  let code=`local ScreenGui = Instance.new("ScreenGui")\n`;
  [...document.querySelectorAll('.ui-element')].forEach(e=>{
    const nm=e.dataset.name, t=e.dataset.type;
    const l=parseInt(e.style.left), tp=parseInt(e.style.top), w=parseInt(e.style.width), h=parseInt(e.style.height);
    const rgb=(e.dataset.color||'255,255,255').split(',').map(n=>parseInt(n));
    const txt=e.dataset.text||'', img=e.dataset.image?`"rbxassetid://${e.dataset.image}"`:'';
    code += `local ${nm} = Instance.new("${t}")\n`;
    if(!['Folder','Model'].includes(t)){
      code += `${nm}.Size = UDim2.new(0, ${w}, 0, ${h})\n${nm}.Position = UDim2.new(0, ${l}, 0, ${tp})\n`;
      code += `${nm}.BackgroundColor3 = Color3.fromRGB(${rgb.join(',')})\n`;
    }
    if(txt && /Text(Label|Button)/.test(t)) code += `${nm}.Text = "${txt}"\n`;
    if(img) code += `${nm}.Image = ${img}\n`;
    code += `${nm}.Parent = ${e.dataset.parent}\n\n`;
  });
  document.getElementById('output').value = code;
}

document.getElementById('preview').onclick = () => { selected=null; currentParent=null; renderProps(); highlight(); };

refresh();
function refresh(){ renderExplorer(); highlight(); generateCode(); }

</script>

</body>
</html>
